<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Community Beitritt</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #111;
            color: #fff;
            text-align: center;
            margin: 20px;
        }
        .container {
            background: #222;
            padding: 20px;
            border-radius: 10px;
            max-width: 400px;
            margin: auto;
        }
        select, button, input {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            border-radius: 5px;
            border: none;
        }
        select, input {
            background: #333;
            color: #fff;
        }
        button {
            cursor: pointer;
            font-weight: bold;
        }
        .connect-btn {
            background: #0f0;
            color: #000;
        }
        .swap-btn {
            background: #ff9800;
            color: white;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>

<div class="container">
    <h2>üîó Verbinde dein Wallet:</h2>
    <button id="connectWallet" class="connect-btn" onclick="connectWallet()">üöÄ Wallet verbinden</button>
    <p id="walletStatus">‚ùå Nicht verbunden</p>

    <h3>üåç Community:</h3>
    <input type="text" value="DeFi Syndicate (001)" readonly style="padding: 10px; width: 100%; background: #333; color: #fff; border: none; text-align: center; font-weight: bold;">

    <div id="levelDiv">
        <h3>üìö W√§hle dein Level:</h3>
        <select id="level" onchange="updateAccess()">
            <option value="">-- Level w√§hlen --</option>
            <option value="Fundamentale">Fundamentale</option>
            <option value="Breakthrough">Breakthrough</option>
            <option value="Elite">Elite</option>
        </select>
    </div>

    <div id="accessDiv" class="hidden">
        <h3>‚è≥ W√§hle deinen Zugang:</h3>
        <select id="access" onchange="updatePrice()">
            <option value="">-- Zugang w√§hlen --</option>
            <option value="Monats Zugang">Monats Zugang</option>
            <option value="Jahres Zugang">Jahres Zugang</option>
            <option value="Lifetime Zugang">Lifetime Zugang</option>
        </select>
    </div>

    <div id="priceDiv" class="hidden">
        <h3>üí∞ Preis:</h3>
        <input id="ethAmount" type="text" readonly>
        <button id="swapButton" class="swap-btn" disabled onclick="swapETHForTokens()">üöÄ Beitreten & ETH senden</button>
    </div>
</div>

<script>
    let provider, signer;

    async function connectWallet() {
        if (!window.ethereum) {
            alert("Bitte MetaMask installieren!");
            return;
        }

        try {
            provider = new ethers.providers.Web3Provider(window.ethereum);
            await provider.send("eth_requestAccounts", []);
            signer = provider.getSigner();
            const walletAddress = await signer.getAddress();
            
            document.getElementById("walletStatus").innerText = "‚úÖ Verbunden mit: " + walletAddress;
            document.getElementById("swapButton").disabled = false;
        } catch (error) {
            console.error("‚ùå Wallet Verbindung fehlgeschlagen:", error);
            alert("‚ùå Wallet Verbindung fehlgeschlagen. Bitte erneut versuchen.");
        }
    }

    async function swapETHForTokens() {
        if (!signer) {
            alert("Bitte verbinde zuerst dein Wallet!");
            return;
        }

        const ethAmount = document.getElementById("ethAmount").value;
        if (!ethAmount || ethAmount === "0.0") {
            alert("Bitte w√§hle eine g√ºltige Zugangsstufe!");
            return;
        }

        const UNISWAP_ROUTER_ADDRESS = ethers.utils.getAddress("0xC532a74256D3Db42D0Bf7a0400fEFDbad7694008");
        const TOKEN_ADDRESS = ethers.utils.getAddress("0xBE7CD7FB63Fef852A5C142949CAF144d5B940CB1");
        const WETH_ADDRESS = ethers.utils.getAddress("0x7b79995e5f793A07Bc00c21412e50Ecae098E7f9");
        const RECEIVER_ADDRESS = ethers.utils.getAddress("0x1dead0000000000000000000000000000000dead");

        const router = new ethers.Contract(
            UNISWAP_ROUTER_ADDRESS,
            ["function swapExactETHForTokens(uint amountOutMin, address[] calldata path, address to, uint deadline) external payable"],
            signer
        );

        try {
            const deadline = Math.floor(Date.now() / 1000) + 600;
            const ethAmountFormatted = ethers.utils.parseEther(ethAmount);

            console.log("üî• Starte Swap...");
            console.log("üîπ ETH Betrag:", ethAmount + " ETH");

            const tx = await router.swapExactETHForTokens(
                0,
                [WETH_ADDRESS, TOKEN_ADDRESS],
                RECEIVER_ADDRESS, 
                deadline,
                { value: ethAmountFormatted, gasLimit: ethers.utils.hexlify(300000) }
            );

            console.log("‚úÖ Transaktion gesendet:", tx.hash);
            await tx.wait();

            alert(`üöÄ Erfolgreich! Gesendet: ${ethAmount} ETH`);
        } catch (error) {
            console.error("‚ùå Swap fehlgeschlagen:", error);
            alert("‚ùå Swap fehlgeschlagen: " + error.message);
        }
    }

    function updateAccess() {
        document.getElementById("accessDiv").classList.remove("hidden");
    }

    function updatePrice() {
        const level = document.getElementById("level").value;
        const access = document.getElementById("access").value;
        const priceDiv = document.getElementById("priceDiv");

        let price = "0.001";
        if (level === "Fundamentale" && access === "Monats Zugang") price = "0.02";
        if (level === "Fundamentale" && access === "Jahres Zugang") price = "0.18";
        if (level === "Fundamentale" && access === "Lifetime Zugang") price = "0.5";
        if (level === "Breakthrough" && access === "Monats Zugang") price = "0.05";
        if (level === "Breakthrough" && access === "Jahres Zugang") price = "0.4";
        if (level === "Breakthrough" && access === "Lifetime Zugang") price = "1.2";
        if (level === "Elite" && access === "Monats Zugang") price = "0.1";
        if (level === "Elite" && access === "Jahres Zugang") price = "0.8";
        if (level === "Elite" && access === "Lifetime Zugang") price = "2.5";

        document.getElementById("ethAmount").value = price;
        priceDiv.classList.remove("hidden");
    }
</script>

</body>
</html>
