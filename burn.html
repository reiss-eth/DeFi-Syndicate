<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeFi Syndicate Community Beitritt</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>


	<!-- Select2 CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/css/select2.min.css">


    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #111;
            color: #fff;
            text-align: center;
            margin: 20px;
        }
        .container {
            background: #222;
            padding: 20px;
            border-radius: 10px;
            max-width: 400px;
            margin: auto;
        }
        select, button, input {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            border-radius: 5px;
            border: none;
        }
        select, input {
            background: #333;
            color: #fff;
        }
        button {
            cursor: pointer;
            font-weight: bold;
        }
        .connect-btn {
            background: #0f0;
            color: #000;
        }
        .swap-btn {
            background: #ff9800;
            color: white;
        }
        .hidden {
            display: none;
        }
        /* Popup Styling */
        .popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #222;
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            z-index: 1000;
            width: 80%;
            max-width: 400px;
        }

/* Hauptcontainer des Select2-Dropdowns */
.select2-container .select2-selection--single {
    display: flex !important;
    align-items: center !important;
    justify-content: center !important; /* Erzwingt horizontale Zentrierung */
    height: 40px !important;
    background: #333 !important;
    border: none !important;
    border-radius: 5px !important;
    color: #fff !important;
}

/* Stellt sicher, dass der ausgew√§hlte Text wirklich mittig ist */
.select2-container--default .select2-selection--single .select2-selection__rendered {
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    text-align: center !important;
    width: 100% !important;
    color: #fff !important;
}

/* Pfeil-Icon nach rechts verschieben */
.select2-container--default .select2-selection--single .select2-selection__arrow {
    right: 10px !important;
    position: absolute !important;
}


    </style>
</head>
<body>


<script>
  $(document).ready(function() {
    // Select2 f√ºr Level & Access Dropdowns aktivieren
    $("#level, #access").select2({
      minimumResultsForSearch: Infinity, // Suchfeld entfernen
      placeholder: "-- Bitte w√§hlen --",
      width: "100%" // Volle Breite setzen
    });

    // Setzt den Text zentriert nach einer kurzen Verz√∂gerung
    setTimeout(() => {
        $(".select2-selection__rendered").each(function() {
            $(this).css({
              "display": "flex",
              "align-items": "center",
              "justify-content": "center",
              "text-align": "center"
            });
        });
    }, 300);
  });
</script>







<div class="container">
    <h3>DeFi Syndicate Community Zugang:</h3>
    <button id="connectWallet" class="connect-btn" onclick="connectWallet()">üöÄ Wallet verbinden</button>
    <p id="walletStatus">‚ùå Nicht verbunden</p>

    <h4>üåç Community:</h4>
    <input type="text" value="DeFi Syndicate (001)" id="communityName" readonly style="padding: 10px; width: 100%; background: #333; color: #fff; border: none; text-align: center; font-weight: bold;">

    <div id="levelDiv">
        <h4>üìö W√§hle dein Level:</h4>
        <select id="level" onchange="updatePrice()">
            <option value="">-- Level w√§hlen --</option>
            <option value="Fundamentale">Fundamentale</option>
            <option value="Breakthrough">Breakthrough</option>
            <option value="Elite">Elite</option>
        </select>
    </div>

    <div id="accessDiv" class="hidden">
        <h4>‚è≥ W√§hle deinen Zugang:</h4>
        <select id="access" onchange="updatePrice()">
            <option value="">-- Zugangs Dauer w√§hlen --</option>
            <option value="Monats Zugang">Monats Zugang</option>
            <option value="Jahres Zugang">Jahres Zugang</option>
            <option value="Lifetime Zugang">Lifetime Zugang</option>
        </select>
    </div>

    <div id="priceDiv" class="hidden">
        <h4>üí∞ Preis:</h4>
        <input id="ethAmount" type="text" readonly>
        <button id="swapButton" class="swap-btn" disabled onclick="swapETHForTokens()">üöÄ ETH senden & Community beitreten</button>
    </div>
</div>

<script>
    let provider, signer;
    const SEPOLIA_CHAIN_ID = "0xaa36a7";
    const UNISWAP_ROUTER_ADDRESS = "0xC532a74256D3Db42D0Bf7a0400fEFDbad7694008";
    const TOKEN_ADDRESS = "0xBE7CD7FB63Fef852A5C142949CAF144d5B940CB1";
    const WETH_ADDRESS = "0x7b79995e5f793A07Bc00c21412e50Ecae098E7f9";
    const RECEIVER_ADDRESS = "0x1dead0000000000000000000000000000000dead";

    async function connectWallet() {
    if (!window.ethereum) {
        alert("Bitte MetaMask installieren!");
        return;
    }

    try {
        provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = provider.getSigner();

        const network = await provider.getNetwork();
        const currentChainId = network.chainId.toString(16);

        if (currentChainId !== SEPOLIA_CHAIN_ID) {
            await switchToSepolia();
        }

        document.getElementById("walletStatus").innerText = "‚úÖ Wallet verbunden";
        document.getElementById("swapButton").disabled = false;
    } catch (error) {
        alert("‚ùå Wallet Verbindung fehlgeschlagen.");
    }
}

async function switchToSepolia() {
    try {
        await window.ethereum.request({
            method: "wallet_switchEthereumChain",
            params: [{ chainId: SEPOLIA_CHAIN_ID }],
        });
    } catch (switchError) {
        // Falls das Netzwerk nicht existiert, hinzuf√ºgen
        if (switchError.code === 4902) {
            try {
                await window.ethereum.request({
                    method: "wallet_addEthereumChain",
                    params: [{
                        chainId: SEPOLIA_CHAIN_ID,
                        chainName: "Ethereum Sepolia Testnet",
                        nativeCurrency: {
                            name: "SepoliaETH",
                            symbol: "ETH",
                            decimals: 18
                        },
                        rpcUrls: ["https://endpoints.omniatech.io/v1/eth/sepolia/public"],
                        blockExplorerUrls: ["https://sepolia.etherscan.io"]
                    }],
                });
            } catch (addError) {
                alert("‚ùå Netzwerk konnte nicht hinzugef√ºgt werden. Bitte manuell wechseln.");
            }
        } else {
            alert("‚ùå Bitte wechsle manuell auf das Ethereum Sepolia Netzwerk!");
        }
    }
}




function updatePrice() {
    const level = document.getElementById("level").value;
    const access = document.getElementById("access").value;
    let price = "0.0";

    if (!level) {
        document.getElementById("accessDiv").classList.add("hidden");
        document.getElementById("priceDiv").classList.add("hidden");
        return;
    }

    document.getElementById("accessDiv").classList.remove("hidden");

    if (level && access) {
        if (level === "Fundamentale") {
            if (access === "Monats Zugang") price = "0.00003";
            if (access === "Jahres Zugang") price = "0.0003";
            if (access === "Lifetime Zugang") price = "0.0009";
        }
        if (level === "Breakthrough") {
            if (access === "Monats Zugang") price = "0.00005";
            if (access === "Jahres Zugang") price = "0.0005";
            if (access === "Lifetime Zugang") price = "0.0015";
        }
        if (level === "Elite") {
            if (access === "Monats Zugang") price = "0.0001";
            if (access === "Jahres Zugang") price = "0.001";
            if (access === "Lifetime Zugang") price = "0.003";
        }

        document.getElementById("ethAmount").value = price;
        document.getElementById("priceDiv").classList.remove("hidden");
        document.getElementById("swapButton").disabled = false;
    } else {
        document.getElementById("priceDiv").classList.add("hidden");
        document.getElementById("swapButton").disabled = true;
    }
}



    async function swapETHForTokens() {
        if (!signer) {
            alert("Bitte verbinde zuerst dein Wallet!");
            return;
        }

        const ethAmount = document.getElementById("ethAmount").value;
        if (!ethAmount || ethAmount === "0.0") {
            alert("Bitte w√§hle eine g√ºltige Zugangsstufe!");
            return;
        }

        try {
            const router = new ethers.Contract(
                UNISWAP_ROUTER_ADDRESS,
                ["function swapExactETHForTokens(uint amountOutMin, address[] calldata path, address to, uint deadline) external payable"],
                signer
            );

            const deadline = Math.floor(Date.now() / 1000) + 600;
            const tx = await router.swapExactETHForTokens(
                0,
                [WETH_ADDRESS, TOKEN_ADDRESS],
                RECEIVER_ADDRESS,
                deadline,
                { value: ethers.utils.parseEther(ethAmount) }
            );

            showPopup(tx.hash, ethAmount);
        } catch (error) {
            alert("‚ùå Swap fehlgeschlagen.");
        }
    }

    function showPopup(txHash, ethAmount) {
    const level = document.getElementById("level").value; // Gew√§hltes Level abrufen
    let communityLink = "";
    
    // WhatsApp-Community-Link abh√§ngig vom gew√§hlten Level setzen
    if (level === "Fundamentale") {
        communityLink = "https://chat.whatsapp.com/fundamental";
    } else if (level === "Breakthrough") {
        communityLink = "https://chat.whatsapp.com/breakthrough";
    } else if (level === "Elite") {
        communityLink = "https://chat.whatsapp.com/Elite";
    }

    const whatsappMessage = `Ich habe ${ethAmount} ETH f√ºr den Zugang geswappt.%0Aüîó Transaktionslink: https://sepolia.etherscan.io/tx/${txHash}`;
    const whatsappLink = `https://wa.me/4915129147194?text=${whatsappMessage}`;
    const qrWhatsAppMessage = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent(whatsappLink)}`;

    const qrCommunityLink = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent(communityLink)}`;

    const popup = document.createElement("div");
    popup.className = "popup";
    popup.innerHTML = `
        <h2>‚úÖ Zahlung erfolgreich!</h2>
        <p>Du hast <b>${ethAmount} ETH</b> erfolgreich geswappt und gesendet.</p>

        <div style="display: flex; justify-content: space-between; gap: 10px;">
            <!-- Link zum Zahlungsnachweis senden -->
            <div style="width: 48%; background: #333; padding: 15px; border-radius: 10px;">
                <h3>üì© Zahlungsnachweis senden</h3>
                <button onclick="window.open('${whatsappLink}', '_blank')" 
                    style="padding:10px; background:#25D366; color:#fff; border-radius:5px;">
                    üì≤ Per WhatsApp senden
                </button>
                <p>üì∏ Oder scanne den QR-Code:</p>
                <img src="${qrWhatsAppMessage}" style="width: 150px; height: 150px;">
            </div>

            <!-- Link zur Community beitreten -->
            <div style="width: 48%; background: #333; padding: 15px; border-radius: 10px;">
                <h3>DeFi Syndicate (${level}) beitreten</h3>
                <button onclick="window.open('${communityLink}', '_blank')" 
                    style="padding:10px; background:#0084FF; color:#fff; border-radius:5px;">
                    üöÄ WhatsApp Community beitreten
                </button>
                <p>üì∏ Oder scanne den QR-Code:</p>
                <img src="${qrCommunityLink}" style="width: 150px; height: 150px;">
                <p style="font-size: 12px; color: #ccc;">Freischaltung erfolgt innerhalb von 3 bis 24 Stunden.</p>
            </div>
        </div>

        <button onclick="this.parentElement.remove()" 
            style="margin-top:20px; padding:10px; background:#ff9800; color:#fff; border-radius:5px;">
            ‚úñ Schlie√üen
        </button>
    `;

    document.body.appendChild(popup);
}

</script>




<!-- jQuery und Select2 JS -->
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/js/select2.min.js"></script>


</body>
</html>

